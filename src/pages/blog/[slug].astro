---
import Layout from '@/layouts/layout.astro';
import { type GetStaticPaths } from 'astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection, getEntry, render } from 'astro:content';

export const getStaticPaths: GetStaticPaths = async () => {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id.replace('.md', '') },
    props: { post },
  }));
};

const { slug } = Astro.params;
const { post } = Astro.props as {
  post: CollectionEntry<'blog'>;
};

const author = await getEntry('authors', post.data.author.id);
const Content = await render(post);
---

<Layout>
  <div class="max-w-content p-8 bg-reading-surface space-y-4 items-center mx-auto rounded-t-2xl">
    <h1 class="text-5xl font-bold glass">{post.data.title}</h1>
    {
      post.data.coverImage && (
        <img
          src={post.data.coverImage}
          alt={post.data.title}
          class="rounded-t-2xl min-w-full"
        />
      )
    }
    <article class="prose dark:prose-invert prose-xl min-w-full p-4">
      <Content.Content />

      <br />
      {author?.data.name}
      <br />
      {author?.data.linkedin}
    </article>
  </div>
</Layout>
